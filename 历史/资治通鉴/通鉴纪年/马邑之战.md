雁门马邑豪聂壹，因大行王恢言：“匈奴初和亲，亲信边， 可诱以利致之，伏兵袭击，必破之道也。”上召问公卿。王恢曰：“臣闻全代之时，北有强胡之敌，内连中国之兵，然尚得养老、长幼，种树以时，仓廪常实，匈奴不轻侵也.今以陛下之威，海内为一；然匈奴侵盗不已者，无他，以不恐之故耳。臣窃以为击之便。”韩安国曰：“臣闻高皇帝尝围于平城，七日不食；及解围反位而无忿怒之心。夫圣人以天下为度者也，不以己私怒伤天下之公，故遣刘敬结和亲，至今为五世利。臣窃以为勿击便。”恢曰：“不然。高帝身被坚执锐，行几十年　，所以不报平城之怨者，非力不能，所以休天下之心也。今边境数惊，士卒伤死，中国车相望，此仁人之所隐也。故曰击之便。”安国曰：“不然。臣闻用兵者以饱待饥，正治以待其乱，定舍以待其劳；故接兵覆众，伐国堕城，常坐而役敌国，此圣人之兵也。今将卷甲轻举，深入长驱，难以为功；从行则迫胁，衡行则中绝，疾则粮乏，徐则后利，不至千里，人马乏食。《兵法》曰：‘遗人，获也。’臣故曰勿击便。”恢曰：“不然。臣今言击之者，固非发而深入也；将顺因单于之欲，诱而致之边，吾选枭骑、壮士阴伏而处以为之备，审遮险阻以为其戒。吾势已定，或营其左，或营其右，或当其前，或绝其后，单于可禽，百全必取。”上从恢议。
夏，六月，以御史大夫韩安国为护军将军， 卫尉李广为骁骑将军，太仆公孙贺为轻车将军，大行王恢为将屯将军，太中大夫李息为材官将军，将车骑、材官三十余万匿马邑旁谷中，约单于入马邑纵兵。阴使聂壹为间，亡入匈奴，谓单于曰：“吾能斩马邑令、丞，以城降，财物可尽得。”单于爱信，以为然而许之。聂壹乃诈斩死罪囚，悬其头马邑城下，示单于使者为信，曰：“马邑长吏已死，可急来！”于是单于穿塞，将十万入武州塞。未至马邑百余里，见畜布野而无人牧者，怪之。乃攻亭，得雁门尉史，欲杀之；尉史乃告单于汉兵所居。单于大惊曰：“吾固疑之。”乃引兵还，出曰：“吾得尉史，天也！”以尉史为天王。塞下传言单于已去，汉兵追至塞，度弗及，乃皆罢兵。王恢主别从代出击胡辎重，闻单于还，兵多，亦不敢出。
上怒恢。恢曰：“始，约为入马邑城，兵与单于接，而臣击其辎重， 可得利。今单于不至而还，臣以三万人众不敌，只取辱。　固知还而斩，然完陛下士三万人。”于是下　恢廷尉，廷尉当“恢逗桡，当斩。”恢行千金丞相，不敢言上，而言于太后曰：“王恢首为马邑事，今不成而诛恢，是为匈奴报仇也。”上朝太后，太后以言告上。上曰：“首为马邑事者恢，故发天下兵数十万，从其言为此。且纵单于不可得，恢所部击其辎重，犹颇可得以尉士大夫心。今不诛恢，无以射天下。”于是恢闻，乃自杀。自是之后，匈奴绝和亲，　攻当路塞，往往入盗于汉边，不可胜数；然尚贪乐关市，嗜汉财物；汉亦关市不绝以中其意。